<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Survey</title>
  <!-- Latest compiled and minified CSS & JS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
  <script src="https://code.jquery.com/jquery.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>

</head>
<body>

  <div class="container">
    <div class="row">
        <div class="col-lg-12">
          <h1>Survey Questions</h1>
          <hr>
        </div>
    </div>  
    <form>
      <div class="row">
        <div class="col-lg-12">
          <h2>About You</h2>
          <p>Name (Required)</p>
          <input type="text" id="name">
          <br>
          <p>Link to Photo Image (Required)</p>
          <input type="text" id="photo">
          <br>
          <hr>
          <h3>Question 1</h3>
          <p>You have a soft spot in your heart for small fluffy animals</p>
          <select id = "question1">
            <option value="1">1 (Strongly Disagree)</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="4">5 (Strongly Agree)</option>
          </select>
      
          <h3>Question 2</h3>
          <p>You have a soft spot in your heart for small fluffy animals</p>
          <select id = "question2">
              <option value="1">1 (Strongly Disagree)</option>
              <option value="2">2</option>
              <option value="3">3</option>
              <option value="4">4</option>
              <option value="4">5 (Strongly Agree)</option>
          </select>

          <h3>Question 3</h3>
          <p>You have a soft spot in your heart for small fluffy animals</p>
          <select id = "question3">
              <option value="1">1 (Strongly Disagree)</option>
              <option value="2">2</option>
              <option value="3">3</option>
              <option value="4">4</option>
              <option value="4">5 (Strongly Agree)</option>
          </select>

          <h3>Question 4</h3>
          <p>You have a soft spot in your heart for small fluffy animals</p>
            <select id = "question4">
              <option value="1">1 (Strongly Disagree)</option>
              <option value="2">2</option>
              <option value="3">3</option>
              <option value="4">4</option>
              <option value="4">5 (Strongly Agree)</option>
          </select>

          <h3>Question 5</h3>
          <p>You have a soft spot in your heart for small fluffy animals</p>
            <select id = "question5">
              <option value="1">1 (Strongly Disagree)</option>
              <option value="2">2</option>
              <option value="3">3</option>
              <option value="4">4</option>
              <option value="4">5 (Strongly Agree)</option>
          </select>

          <h3>Question 6</h3>
          <p>You have a soft spot in your heart for small fluffy animals</p>
            <select id = "question6">
              <option value="1">1 (Strongly Disagree)</option>
              <option value="2">2</option>
              <option value="3">3</option>
              <option value="4">4</option>
              <option value="4">5 (Strongly Agree)</option>
          </select>

          <h3>Question 7</h3>
          <p>You have a soft spot in your heart for small fluffy animals</p>
            <select id = "question7">
              <option value="1">1 (Strongly Disagree)</option>
              <option value="2">2</option>
              <option value="3">3</option>
              <option value="4">4</option>
              <option value="4">5 (Strongly Agree)</option>
          </select>

          <h3>Question 8</h3>
          <p>You have a soft spot in your heart for small fluffy animals</p>
            <select id = "question8">
              <option value="1">1 (Strongly Disagree)</option>
              <option value="2">2</option>
              <option value="3">3</option>
              <option value="4">4</option>
              <option value="4">5 (Strongly Agree)</option>
          </select>

          <h3>Question 9</h3>
          <p>You have a soft spot in your heart for small fluffy animals</p>
             <select id = "question9">
              <option value="1">1 (Strongly Disagree)</option>
              <option value="2">2</option>
              <option value="3">3</option>
              <option value="4">4</option>
              <option value="4">5 (Strongly Agree)</option>
          </select>

          <h3>Question 10</h3>
          <p>You have a soft spot in your heart for small fluffy animals</p>
             <select id = "question10">
              <option value="1">1 (Strongly Disagree)</option>
              <option value="2">2</option>
              <option value="3">3</option>
              <option value="4">4</option>
              <option value="4">5 (Strongly Agree)</option>
          </select>
          <br>
          <br>
          <button type="submit" class="btn btn-primary btn-block submit" data-toggle="modal" data-target="#myModal" id="searchBtn"></span><span class="glyphicon glyphicon-ok-circle"></span> Submit</button>
        </div>
      </div>
    </form> 
    <hr>
    <div class="row">
      <div class="col-lg-12 apiLinks">
        <a href="/api/friends" class="left">API Friends List</a>
        <a href="https://github.com/Tasha-GitHub/Friend-Finder" target="_blank">Github Repo</a>
      </div>
    </div>

    <!-- Modal -->
    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="myModalLabel"></h4>
          </div>
          <div class="modal-body">
            ...
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</body>
</html>
<script type="text/javascript">
  // ==============================================================================
  // capture user input on click
  // ==============================================================================

    $(".submit").on("click", function(event) {
      var name = $("#name").val().trim();
      var photo =$("#photo").val().trim();
      
      //prevents user from inputting nothing
      if(photo.length ===0 || name.length ===0){
        return;
      }
      //stops form from performing its default action
      event.preventDefault();
      var Q1 = $("#question1").val();
      Q1 = parseInt(Q1);
      var Q2 = $("#question2").val();
      Q2 = parseInt(Q2);
      var Q3 = $("#question3").val();
      Q3 = parseInt(Q3);
      var Q4 = $("#question4").val();
      Q4 = parseInt(Q4);
      var Q5 = $("#question5").val();
      Q5 = parseInt(Q5);
      var Q6 = $("#question6").val();
      Q6 = parseInt(Q6);
      var Q7 = $("#question7").val();
      Q7 = parseInt(Q7);
      var Q8 = $("#question8").val();
      Q8 = parseInt(Q8);
      var Q9 = $("#question9").val();
      Q9 = parseInt(Q9);
      var Q10 = $("#question10").val();
      Q10 = parseInt(Q10);
      
      
      // Here we grab the form elements and package them in an object
      var friendStats = {
        name: name,
        photo: photo,
        scores: [Q1,Q2,Q2,Q4,Q5,Q6,Q7,Q8,Q9,Q10]
      };

      

// ==============================================================================
// Submit to server and clear form
// ==============================================================================
      var currentURL = window.location.origin;

      $.post(currentURL + "/api/newfriend", friendStats,
        function() {
          // Clear the form when submitting
          $("#name").val("");
          $("#photo").val("");
        });
      //find match
      matchMaker();
    });

// ==============================================================================
// get stats compare whos better
// ==============================================================================
    function matchMaker() {

      // Here we get the location of the root page.
      var currentURL = window.location.origin;
      var differenceArray = [];
      var finalScores = [];
      var totalDifference = 0;
      var userScore;

      // The AJAX function uses the URL of our API to GET the data associated with it
      $.ajax({ url: currentURL + "/api/friends", method: "GET" })
      .done(function(data) {
        
        //get users score and adds it to an array
        var arraylength = data.length -1;
        userScore = data[arraylength].scores;
        
        //loops through all people in api and calculates the difference between their score and user score
        for(var i = 0; i  < data.length - 1; i++){
          
          for(var j = 0 ; j < data[i].scores.length; j++){
            var input = data[i].scores[j] - userScore[j];
            if (input< 0){
              //converts input to always being a + number
              input = input * -1;
            }
            //will create an array full of differences 
            differenceArray.push(input);
            totalDifference += input;
          }
          //pushes the differences object into a new object
          finalScores.push(totalDifference);
          totalDifference = 0;
        
          
        }
        //finds the value with the smallest difference to the user
        var lowestValue =Math.min.apply(null, finalScores);
        //grabs the index of this low value
        var friendIndex = finalScores.indexOf(lowestValue);
        
        //finds the correlating friend from our response
        var idealFriendName = data[friendIndex].name;
        var idealFriendPhoto = data[friendIndex].photo;
        
        
        //prints winner to html for user to see
        $(".modal-title").html("Your Best Match is " + idealFriendName);
        var newImg = $("<img>");
        newImg.attr("src" , idealFriendPhoto);
        $(".modal-body").html(newImg);
        

      });
    }


</script>
